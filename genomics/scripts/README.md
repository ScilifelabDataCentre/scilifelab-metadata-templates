# Genomics Experimental Metadata Template Scripts
This folder contains scripts for generating the SciLifeLab Genomics Technical Metadata Template. 
## List of files
- `generate_genomics_template.py`: main script to generate the genomics template, see below for more information.
- `generate_json_schema.py`: script to generate the genomics template schema, against which filled-in tsvs can be validated
- `requirements.txt`: list of python dependencies 
- `technical_metadata_fields_incl_ENA_CVs.yml`: list of relevant technical metadata fields, including ENA controlled vocabularies where available
- `update_ENA_controlled_vocabs.py`: functionality to fetch ENA's controlled vocabularies, based on [template_updater.py](https://github.com/ELIXIR-Belgium/ENA-metadata-templates/blob/main/scripts/template_updater.py), copyright @ Elixir Belgium and licensed under the MIT license.
- `validate_json_schema.py`: script to validate filled-in tsv files against the genomics template json schema.

## Generate_genomics_template.py

The template files (_.tsv_, _.json_) are generated by the script [generate_genomics_template.py](https://github.com/ScilifelabDataCentre/scilifelab-metadata-templates/blob/main/genomics/scripts/generate_genomics_template.py) in a multi step process:
1. It calls [update_ENA_controlled_vocabs.py](https://github.com/ScilifelabDataCentre/scilifelab-metadata-templates/blob/main/genomics/scripts/update_ENA_controlled_vocabs.py) which fetches the controlled vocabularies for relevant fields from ENA's _xsd_ schema files and stores them in [technical_metadata_fields_incl_ENA_CVs.json](https://github.com/ScilifelabDataCentre/scilifelab-metadata-templates/tree/main/genomics/technical_metadata_fields_incl_ENA_CVs.json). The ENA xsd files are accessed at https://github.com/enasequence/webin-xml/tree/master/src/main/resources/uk/ac/ebi/ena/sra/schema. 
2. It then merges the relevant technical fields  with the SciLifeLab organisational metadata fields specified in [../organisation_metadata_fields.yml](https://github.com/ScilifelabDataCentre/scilifelab-metadata-templates/blob/main/organisational_metadata_fields.yml) and writes the result to both a `json` and `tsv` file (header only).
3. It updates the list of the included metadata fields in the genomics readme. 

## Regenerating the template
### Manually
To regenerate _manually_, execute the following steps from the `scripts` folder. 

1. Install dependencies
```
pip install -r requirements.txt
```

2. Regenerate template (includes re-fetching the controlled vocabularies from ENA)
```
python generate_genomics_template.py
```
3. Regenerate schema
```
python generate_json_schema.py
```
### Via a dedicated GitHub Action [Preferred]
More conveniently, there is also a _GitHub Action_ called [update_genomics_template.yml](https://github.com/ScilifelabDataCentre/scilifelab-metadata-templates/blob/main/.github/workflows/update_genomics_template.yml). 
It is set to run once a week and can also be triggered manually from the [GitHub web interface](https://github.com/ScilifelabDataCentre/scilifelab-metadata-templates/actions/workflows/update_genomics_template.yml). 
It runs the `generate_genomics_template.py` script, fetching the controlled vocabularies and generating an updated template. 
If it detects changes in the template it opens a PR allowing for the changes to be reviewed and manually merged if necessary. 
